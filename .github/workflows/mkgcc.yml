name: Build CyrOS Mobile gnome-control-center

on:
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch to build"
        required: true
        default: "main"

jobs:
  build:
    runs-on: ubuntu-24.04-arm

    steps:
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            git \
            devscripts \
            build-essential \
            meson \
            ninja-build \
            pkg-config \
            gettext \
            gtk-doc-tools \
            libxml2-utils

      - name: Clone source
        run: |
          git clone https://github.com/droidian/gnome-control-center.git src
          cd src
          git checkout ${{ github.event.inputs.branch }} || true

      - name: Extract build deps (WITHOUT versions)
        run: |
          cd src
          echo "Extracting clean dependency list..."
          awk '/^Build-Depends:/,/^(Build-Conflicts|Maintainer)/' debian/control \
            | sed 's/Build-Depends://g' \
            | tr -d '\n' \
            | sed 's/,/\n/g' \
            | sed 's/([^)]*)//g' \
            | sed 's/|.*//g' \
            | sed 's/<[^>]*>//g' \
            | sed 's/\[.*\]//g' \
            | sed 's/${.*}//g' \
            | tr -d ' ' \
            | sed '/^$/d' \
            > ../build-deps-clean.txt

          echo "== Clean build deps =="
          cat ../build-deps-clean.txt

      - name: Install build deps
        run: |
          sudo apt-get update
          sudo apt-get install -y $(cat build-deps-clean.txt)

      - name: Build package
        run: |
          cd src
          dpkg-buildpackage -b -us -uc

      - name: Collect artifacts
